<!DOCTYPE html>
<html lang="eng">
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <title>persons non Ã¨ un errore</title>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="Chart.js-2.9.4/dist/Chart.js"></script>
    <script src="Chart.js-2.9.4/dist/Chart.bundle.js"></script>
    <script src="Chart.js-2.9.4/dist/Chart.min.js"></script>
    <script src="Chart.js-2.9.4/dist/Chart.bundle.min.js"></script>
    <script src="https://d3js.org/d3.v5.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/d3-selection.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>

    <style>
        div#container {
            width: 800px;
        }
    </style>
</head>
<body>
<div>
    <button onclick="doit('bar_person_subtype.csv')">persons</button>
</div>

<div id="container">
    <canvas id="chart"></canvas>
</div>


<script>

    function doit(csvpath) {
        const cic = document.getElementById("chart").getContext("2d");

        d3.csv(csvpath).then(makeChart);

        function makeChart(data) {
            // data is an array of objects where each object represents a country
            var subtypes = data.map(function (d) {
                return d.subtype;
            });
            var count = data.map(function (d) {
                return d.count_coll;
            });

            const arrayOfObj = subtypes.map(function (d, i) {
                return {
                    label: d,
                    data: count[i] || 0,
                }
            })

            const sortedArrayOfObj = arrayOfObj.sort(function (a, b) {
                return b.data - a.data
            })

            let newArrayLabel = []
            let newArrayData = []
            sortedArrayOfObj.forEach(function (d) {
                newArrayLabel.push(d.label)
                newArrayData.push(d.data)
            })


            new Chart(cic, {
                type: "bar",
                options: {
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'Number of of people studied by their profession'
                    },
                    scales: {
                        yAxes: [
                            {
                                ticks: {
                                    beginAtZero: true
                                }
                            }
                        ]
                    }
                },
                data: {
                    labels: newArrayLabel,
                    datasets: [
                        {
                            label: "number",
                            data: newArrayData,
                            backgroundColor: ["#cc33ff","#c560e6","#c67cdf","#cb91de","#d8b5e3","#dfc5e7","#cdabd8","#b79bbf","#a69fa8","#8f8f8f"]
                        }
                    ]
                }
            });
        }
    }
</script>

<!-- External JS libraries
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script  type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
<script  type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
<script type='text/javascript' src='loader.js'></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
-->
</body>
</html>