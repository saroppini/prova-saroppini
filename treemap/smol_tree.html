<!DOCTYPE html>
<head>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.js"></script>
<style>
.rect {
  fill: steelblue;
}
.rect:hover {
  fill: orange;
}
</style>
</head>
<body>
<div id="barchart"></div>


<script>

  
</script>



<div id="treemap"></div>

<script>

// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 10, left: 10},
  width = 750 - margin.left - margin.right,
  height = 550 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#treemap")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// read json data
d3.json("file_for_tree.json", function(data) {

  // Give the data to this cluster layout:
  var root = d3.hierarchy(data).sum(function(d){return d.size}) // Size of each leave is given in the 'size' field in input data

  //TOOLTIP FOR MOUSEOVER
    let tooltip = d3
    .select('body')
    .append('div')
    .style('position', 'absolute')
    .style('z-index', '10')
    .style('visibility', 'hidden')
    .style('background-color', 'white')
    .style('border', 'solid')
    .style('border-width', '2px')
    .style('border-radius', '5px')
    .style('padding', '5px');

  // Then d3.treemap computes the position of each element of the hierarchy
  d3.treemap()
    .size([width, height])
    .paddingTop(28)
    .paddingRight(7)
    .paddingInner(0.7) 
    (root)

  // prepare a color scale
  var color = d3.scaleOrdinal()
    .domain(["Biblioteca Hertziana", "Fondazione Federico Zeri", "Getty Research Institute", "Kunsthistorisches Institut"])
    .range([ "#FDD7D7", "#D5B4B4", "#838383", "#3D3D3D"])

  // And a opacity scale
  var opacity = d3.scaleLinear()
    .domain([1, 6])
    .range([.6,1.5])

  // use this information to add rectangles:
  svg
    .selectAll("rect")
    .data(root.leaves())
    .enter()
    .append("rect")
    .attr('x', function (d) { return d.x0; })
    .attr('y', function (d) { return d.y0; })
    .attr('width', function (d) { return d.x1 - d.x0; })
    .attr('height', function (d) { return d.y1 - d.y0; })
    .style("fill", function(d){ return color(d.parent.data.name)} )
    .style("opacity", function(d){ return opacity(d.data.size)})
    //MOUSEOVER
    .on('mouseover', function() {
      tooltip.style('visibility', 'visible')
    })
    .on('mousemove', function(d) {
      tooltip
        .style('top', d3.event.pageY - 10 + 'px')
        .style('left', d3.event.pageX + 10 + 'px')
        .html(d.data.name + " <br> <hr>" + d.data.size + " elements")

      d3.select(this).style("stroke", "black")
    })
      .on('mouseout', function() {
        tooltip.style('visibility', 'hidden')
        d3.select(this).style("stroke", "none")
      });

  // and to add the text labels
  svg
      .selectAll("text")
      .data(root.leaves())
      .enter()
      .append("text")
      .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.name.substring(0, 4)+'..' })
      .attr("font-size", "15px")
      .attr("fill", "black")
      .on('mouseover', function() {
        tooltip.style('visibility', 'visible');
      })
      .on('mousemove', function(d) {
        tooltip
          .style('top', d3.event.pageY - 10 + 'px')
          .style('left', d3.event.pageX + 10 + 'px')
          .html(d.data.name + " <br> <hr>" + d.data.size + " elements");
      })
      .on('mouseout', function() {
        tooltip.style('visibility', 'hidden');
      });


  // and to add the text labels
  svg
    .selectAll("vals")
    .data(root.leaves())
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+35})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.size })
      .attr("font-size", "13px")
      .attr("fill", "black")
      .on('mouseover', function() {
        tooltip.style('visibility', 'visible')
      })
      .on('mousemove', function(d) {
        tooltip
          .style('top', d3.event.pageY - 10 + 'px')
          .style('left', d3.event.pageX + 10 + 'px')
          .html(d.data.name + " <br> <hr>" + d.data.size + " elements")
      })
      .on('mouseout', function() {
        tooltip.style('visibility', 'hidden')
      });

  // Add title for the 3 groups
  svg
    .selectAll("titles")
    .data(root.descendants().filter(function(d){return d.depth==1}))
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0})
      .attr("y", function(d){ return d.y0+21})
      .text(function(d){ return d.data.name })
      .attr("font-size", "19px")
      .attr("fill",  function(d){ return color(d.data.name)} )

  // Add title for the 3 groups
  svg
    .append("text")
      .attr("x", 200)
      .attr("y", 14)    // +20 to adjust position (lower)
      .text("The distribution of the objects among the keepers")
      .attr("font-size", "19px")
      .attr("fill",  "black" )


})
</script>

</body>
</html>
