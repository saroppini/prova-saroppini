<!DOCTYPE html>
<html lang="eng">
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <title>persons non Ã¨ un errore</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datasource@0.1.0"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>

    <style>
        div#container {
            width: 800px;
        }
    </style>
</head>
<body>
<div>
    <button onclick="doit('bar_person_subtype.csv')">persons</button>
</div>

<div id="container">
    <canvas id="chart"></canvas>
</div>


<script>

    function doit(csvpath) {
        const cic = document.getElementById("chart").getContext("2d");

        d3.csv(csvpath, function makeChart(data) {
            // data is an array of objects where each object represents a country
            var subtypes = data.map(function (d) {
                return d.subtype;
            });
            var count = data.map(function (d) {
                return d.count_coll;
            });

            const arrayOfObj = subtypes.map(function (d, i) {
                return {
                    label: d,
                    data: count[i] || 0,
                }
            })

            const sortedArrayOfObj = arrayOfObj.sort(function (a, b) {
                return b.data - a.data
            })

            let newArrayLabel = []
            let newArrayData = []
            sortedArrayOfObj.forEach(function (d) {
                newArrayLabel.push(d.label)
                newArrayData.push(d.data)
            })


            new Chart(cic, {
                type: "bar",
                options: {
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'Number of of people studied by their profession'
                    },
                    scales: {
                        yAxes: [
                            {
                                ticks: {
                                    beginAtZero: true
                                }
                            }
                        ]
                    }
                },
                data: {
                    labels: newArrayLabel,
                    datasets: [
                        {
                            label: "number",
                            data: newArrayData,
                            backgroundColor: ["#cc33ff","#c560e6","#c67cdf","#cb91de","#d8b5e3","#dfc5e7","#cdabd8","#b79bbf","#a69fa8","#8f8f8f"]
                        }
                    ]
                }
            });
        })
    }
</script>

</body>
</html>